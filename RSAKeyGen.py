#!/usr/bin/env python

import requests
from random import randint
from random import randrange


class RSAKeyGen(object):
    """
    Generate RSA Key pair using random numbers generated from Random.org
    """

    def __init__(self, url, params=None):
        self.url = url
        self.params = params or {"num": 960,
                                 "min": 0,
                                 "max": 2 ** 16 - 1,
                                 "col": 1,
                                 "base": 2,
                                 "format": "plain",
                                 "rnd": "new"
                                 }
        self.random_nums = []

    def get_random(self):
        """ Query random.org and generate a list of random numbers """
        # request = requests.get(self.url, params=self.params)
        # print request
        # return request.text.split()
        res = [u'0100010100100001', u'0010111110111110', u'1010100100011011', u'0101001100000011',
               u'0010101100000011', u'0001100100000110', u'0111101111011010', u'1011011101111001',
               u'0011101100001011', u'1111010100000011', u'1010110010010010', u'1011001011110110',
               u'0101010111000100', u'1000101101110111', u'0101101001000010', u'0010000011001011',
               u'1011101101111001', u'1011100011010101', u'0110000011001011', u'1101110000000000',
               u'0000000000000010', u'1011011100100111', u'1000011100101001', u'1110111011010101',
               u'0110000011000100', u'0110111010101100', u'0000010010100111', u'0011010011010000',
               u'1111010010111100', u'1001100000000111', u'1111100010100110', u'0011100111000001',
               u'1011100010101101', u'0111101110100110', u'1010100101011101', u'0111000001100010',
               u'1111010011000010', u'0101011110100111', u'0110001111111100', u'0111101111010000',
               u'1110100001100100', u'1010101101100100', u'0011100010101001', u'0010000011000100',
               u'1011010100111011', u'0000010111100010', u'1000110101000111', u'0000100111011111',
               u'0110100111100111', u'0111000010110100', u'1100100010101100', u'0010110000001001',
               u'0011111011010011', u'1100100101011110', u'0010110011101111', u'1010100010100110',
               u'0010101100010111', u'0111111111011111', u'0111000111011101', u'1110110101110101',
               u'1011011010000111', u'0101101001000111', u'1000000000111110', u'1100101000101100',
               u'0000100111000011', u'0101101110000101', u'1010111110101001', u'1001010000010001',
               u'0110100100010000', u'0110110101010110', u'0000101110011011', u'1111101011000011',
               u'1110011111011001', u'1101101111000110', u'1101011110101100', u'0000110110100100',
               u'0111001000001001', u'0011110000011110', u'0010010011100000', u'1101100110011100',
               u'1010010001010101', u'0011110000011000', u'0011100000011100', u'1111101110010011',
               u'1001001110111001', u'0111001111010110', u'0110100000110110', u'0001100000000011',
               u'0001100000001100', u'0001111110000111', u'0111001000001011', u'1100001100010001',
               u'1101011100111111', u'0011010010010101', u'0011000011010101', u'1111101110000100',
               u'1110101001101010', u'0011001011100011', u'1111101011001111', u'1000010011110000',
               u'1001000011011001', u'1010000000000101', u'1110001010011010', u'1000001000000000',
               u'0011000000100011', u'0100000011011110', u'0011100110000110', u'1100001010011100',
               u'1001111101001111', u'1010110111110011', u'0111010010100101', u'1001011001101010',
               u'0000111101010100', u'0100110111111010', u'1011011001000101', u'0010001111001101',
               u'0000010101011101', u'0011110110101010', u'1010000111110110', u'0000101110000011',
               u'1001011100100111', u'1000111011011110', u'1101011010111100', u'0000100010101000',
               u'0000101110011011', u'1001010110110110', u'1110011111001001', u'1111000101101100',
               u'1100010000110101', u'0001001010101101', u'0000110111101100', u'1001001001101001',
               u'1110111101100110', u'1010110000001110', u'1011010010111000', u'1001011010000001',
               u'1001010000101100', u'0100000101011011', u'1100000011111010', u'1010011100011001',
               u'0010111001110100', u'0100101101001110', u'1010101000100011', u'0011100110110010',
               u'0110111110011001', u'1010011101000110', u'0100010010111100', u'0101001010010000',
               u'1110101110111001', u'1110101111110101', u'1010011111111110', u'1101100110101001',
               u'1010111111000010', u'0011100111101111', u'1111001000111110', u'0010011001000101',
               u'0111100010000111', u'0100010001011000', u'0111100010110000', u'1111000000101000',
               u'0010100001000001', u'1101110000101010', u'0010000010110111', u'1011000011001011',
               u'1110010010100110', u'1010111011101010', u'1000011001001010', u'1010010101011000',
               u'1110000001000000', u'0000010001111000', u'0100111100010010', u'1110111111100100',
               u'0010000011000001', u'1001001110101011', u'0001101000111011', u'0110101001110110',
               u'1000100101100111', u'1100011000111100', u'1110101001010100', u'1011010110101111',
               u'0111001110111010', u'0001000010010000', u'0001011111100110', u'0100111011001011',
               u'1110000100011110', u'1000101001001001', u'1101100101000110', u'0110011100010000',
               u'0011110110110111', u'1101011001110111', u'1110100110100010', u'1110000011111111',
               u'0101001000110111', u'1000101100010110', u'0001100000000010', u'1111011000110001',
               u'1111011001100110', u'0000001011100010', u'0111101011011011', u'1010110010000110',
               u'1010001011000100', u'0101101010101100', u'1011000100101010', u'0000100111001000',
               u'0110001100001100', u'1111100101001111', u'1011111010101110', u'1001001101001111',
               u'0101110100100100', u'1111110111000100', u'1010001110111111', u'0001000001111000',
               u'1100000111011011', u'0011011100100101', u'0010110100110000', u'1011001100110011',
               u'0011111111000010', u'1101000101010101', u'1110000010001001', u'0001110000001110',
               u'0100000000011001', u'1101011001111010', u'0011111100100010', u'1001000101010100',
               u'0001011111100001', u'1000100110101101', u'1110110001110001', u'0010011000110100',
               u'1011001011010111', u'1011000000011010', u'0000111110010110', u'0111101111010011',
               u'0101011001011001', u'1001111101011001', u'0111010001101000', u'0110111110000011',
               u'0111110100111111', u'1001011101000100', u'1001110110110010', u'1101100101000110',
               u'1001110100101101', u'1111101000000011', u'1010101000101110', u'0101110000011001',
               u'0001000101100001', u'0110111110110010', u'1111011010110011', u'1010001110110011',
               u'0000001110100010', u'1001000100000001', u'1011000000010111', u'0101011100111011',
               u'0001001001010111', u'0111000111100111', u'1010110011100100', u'0011000010110110',
               u'0000010101001100', u'1011101111011111', u'1000100011011001', u'0000001100001100',
               u'1000100110011110', u'0111000101111001', u'1010100000010010', u'1010010111100110',
               u'0101100000101011', u'1101111011110001', u'1110011010010010', u'0010101011000000',
               u'1011011010010111', u'0101010100101010', u'1000011010100001', u'0000111100010100',
               u'0100111101101010', u'1001100110100110', u'1010010110101111', u'1010011001010101',
               u'0000111101100111', u'1110011111110000', u'1011010010111100', u'0111101001011001',
               u'0101111111100011', u'0000111011011000', u'0111010000011111', u'0000111110010011',
               u'0010011111101111', u'1001001101000101', u'0111000010000000', u'1100010001010110',
               u'0111001001001000', u'1110001001010111', u'0010000110011000', u'1000000000011110',
               u'1010010111001100', u'1001001001010010', u'1001111011110100', u'1101010000101101',
               u'1111100010110001', u'0101010001001110', u'0101001001001100', u'1001011110001111',
               u'1101001001010110', u'1001101000100111', u'1001011100010000', u'1010111001011111',
               u'1100111010101011', u'1111010101010110', u'1011010100011000', u'1011010001111111',
               u'1000001111001010', u'1111101000000001', u'1100001011111100', u'0101100011110000',
               u'0100101111011111', u'0110111110110100', u'1010110111101010', u'1010000001100100',
               u'0010111111100000', u'0011101100101101', u'0010110101101000', u'1111000011010110',
               u'1111110011000100', u'0101101111111101', u'0011001011100100', u'1110110001100100',
               u'1001010100010011', u'0101011001000100', u'0110101001101001', u'0001011011111000',
               u'0111101010101010', u'1110101100011100', u'1010101000010110', u'1000101110001111',
               u'0001001011101001', u'1110110010111111', u'1001110010010001', u'0001000101111110',
               u'1111100001010011', u'0010011010001110', u'0000110001011010', u'1101101001100000',
               u'1100010110110100', u'0111111111010110', u'0110000100010101', u'1000000011010011',
               u'1000100011111011', u'0100100000100110', u'1001111100110011', u'1001100100110000',
               u'0011111110011010', u'1001110100111100', u'0110010001110100', u'0111001110110101',
               u'0010000001101011', u'0110010111100001', u'1011000101001000', u'0110100101001011',
               u'0011101000100011', u'1110010111101110', u'0000010010100000', u'0101011100000101',
               u'1101110110010101', u'1100100000010001', u'0010111000011010', u'0010001101010000',
               u'1001101010101111', u'1101010000111110', u'1111111000100111', u'0100111010110100',
               u'0010000100010100', u'0110111011001010', u'0011000100110000', u'0101110011000011',
               u'0101001100110011', u'0101111010001110', u'1000001000011011', u'0011100101111010',
               u'1100100011110011', u'0011100110001101', u'0111100111000111', u'0101111110010100',
               u'0111111101111000', u'1010011001010000', u'1110010000011000', u'0110000101110110',
               u'0100010001110001', u'0011001111111011', u'1000101111101000', u'0001010111101010',
               u'0101000110110000', u'0111111011110111', u'1011100000000101', u'1000111100100100',
               u'0110110101000010', u'0111000111111111', u'0100101100011111', u'1111101110010011',
               u'1100101101100001', u'0000011010110011', u'0010111011011011', u'0101010100000110',
               u'1100001010000100', u'0110101100110001', u'0011001100010111', u'1100110010100101',
               u'0010000110110010', u'0111110100100110', u'0100110010011111', u'1000010111000011',
               u'1001111100110010', u'0010100000010000', u'1000100110000010', u'0100100100100001',
               u'0011101101100000', u'1100101111111010', u'0101011110110111', u'1011000100110100',
               u'0110010010110101', u'0100001001000001', u'1001001011011100', u'1010111111100001',
               u'0001001010101000', u'1110110111001100', u'1010011111101111', u'0001000100011111',
               u'1010011000100111', u'0100110010000110', u'1010001100101110', u'1011000110110101',
               u'0111111011001101', u'1100111000111010', u'1101000111101100', u'1111111101110111',
               u'1111110111110101', u'1001111100101110', u'1110010011110101', u'0110100111011111',
               u'1011110011010000', u'0010111011100101', u'0101100000001001', u'1111000111001010',
               u'0101101101001101', u'1011000001011110', u'0000101100010110', u'1000100000010000',
               u'1010011001101010', u'1010000100011011', u'0010010000111000', u'1001000001010100',
               u'0011100010100100', u'1000110100111011', u'1101100100100011', u'0010110101101110',
               u'0100011101001001', u'1110000011011101', u'0101111110100111', u'1100101001001001',
               u'1110000001010000', u'1110110010001001', u'1101010110010001', u'1001000001111111',
               u'1010110000011101', u'0000010111010000', u'1110011011010000', u'1001010011100110',
               u'0100000011010111', u'1011110001110101', u'0101000110110001', u'1101010011000110',
               u'0011010110100000', u'1001000000011110', u'0100000010110000', u'0100101001011100',
               u'0000100100100101', u'1011011010110110', u'1111011110101001', u'1011101110010110',
               u'1101001101110000', u'0011110110010010', u'0000100000001001', u'0001001001001110',
               u'0110000111010110', u'0111101101001000', u'1111010000101001', u'0011010111001100',
               u'0110000111100101', u'1110110101000000', u'0101001010010001', u'1100011000100100',
               u'1100001001111001', u'1000101100000011', u'1001110000001010', u'0000011001011110',
               u'1001010011110100', u'0011110000100111', u'0101101111010111', u'1110011100001111',
               u'0000111000011111', u'0110001111111010', u'0001100100000011', u'0101111110111111',
               u'0000101111011010', u'0100110011011010', u'1010010101010101', u'1000111111011101',
               u'1101110001110111', u'1101111010000001', u'1101101011110001', u'0001001111110100',
               u'1010100110001110', u'1110100101011101', u'0110011011100010', u'0111100000100000',
               u'0111001011110000', u'0101110011111100', u'0110100001011011', u'0010001010010101',
               u'0000011110111100', u'0000011101101100', u'1100110010010000', u'0010110100101000',
               u'0010110010011111', u'0000110000010011', u'0001111011001100', u'0101100101001000',
               u'0000101001001101', u'0101110101101101', u'0010100010011110', u'1110010011010000',
               u'0001100010111111', u'0110011001000010', u'0100001001000011', u'0001011100001111',
               u'0101110100110001', u'1011010001100000', u'0001010110100011', u'0101010011111001',
               u'0011001110111111', u'0111101000000010', u'0110110000111111', u'1100111010000000',
               u'1110001101010001', u'1000101010101101', u'1100011011100100', u'1101011101001100',
               u'1110011010100101', u'0101110100011100', u'0001100000011111', u'1100111110111010',
               u'1000101001000110', u'1100000111001110', u'1000000110000010', u'1100010001000010',
               u'1101100001110111', u'1110100010011010', u'0001111011100001', u'1110000100011100',
               u'0100101011101110', u'0000011100100110', u'1000110111111000', u'1101100101110011',
               u'0010111110110011', u'0010100010100110', u'1000111110101000', u'0100011000100100',
               u'1111010010010011', u'0010100010110100', u'0001111111111101', u'1110001011101101',
               u'0010100011010001', u'1000000011111001', u'1111100110010011', u'1110111110011110',
               u'0001000000111110', u'1110111110101010', u'0101001100010011', u'0110001011010010',
               u'0001001110000111', u'0100110010101101', u'1000110111110100', u'0101110001101110',
               u'1011111011110000', u'0100001100101011', u'1101011111000011', u'1000100010100110',
               u'0111111110000011', u'0011110011000001', u'0011011000010001', u'1001111100111011',
               u'1001000110100100', u'1111110000111110', u'0101111000100111', u'1100101110100111',
               u'0111111011110100', u'1111001101101000', u'1100000111111101', u'1011011001011100',
               u'1111001001111101', u'0001101010000011', u'1101001011111100', u'1110001000101010',
               u'0000111101001011', u'1011011010000100', u'0011011110000010', u'1010101110001111',
               u'0010010011101011', u'1110111011101011', u'1001000001101000', u'0110110010110010',
               u'1101000110110110', u'1110101100001101', u'1000111100010000', u'1011000011010110',
               u'1000100101010100', u'1110010111110000', u'1001110101111000', u'1101100101101111',
               u'0110110000110110', u'1010011111000110', u'1110001111110101', u'0110010010001000',
               u'1011010111111110', u'1011111010010110', u'1011100001100101', u'1100101011101011',
               u'0000011010011001', u'1011001000011100', u'0000111101000111', u'1111101010111000',
               u'0011010111100010', u'1000011110111000', u'1011111001000011', u'0010111100011000',
               u'0101111110101011', u'0100011011001000', u'1101100011001111', u'0111111011010100',
               u'1011101111001111', u'1010111110111011', u'1001001001001011', u'1101000111110110',
               u'0100011101011111', u'0000101110100110', u'0101011010010110', u'1011000111100000',
               u'0110111110000111', u'1011111011011001', u'1011100001011110', u'0001001000101010',
               u'1110011111110110', u'0000000001000101', u'0010001110101111', u'0010001111101001',
               u'1111000001001110', u'0010111101000111', u'0000100011101110', u'0100000010000101',
               u'0000111000110000', u'0001010001011011', u'1110011011001000', u'1101000100110101',
               u'0000011110101000', u'0000111101111001', u'0010001110000110', u'0110001100101110',
               u'1101010111111000', u'1000110110111000', u'0110111001111001', u'0100001101001110',
               u'1010011110100101', u'0000001111010110', u'1110110110000100', u'0110110011110101',
               u'0110101000110101', u'0111100111100100', u'1001100110101010', u'1011110010110111',
               u'1011100000100010', u'0111010000001001', u'0100111001111100', u'1000010101101110',
               u'1000000011100001', u'1110100010000000', u'0000000001111100', u'0000011010001110',
               u'1110000001101101', u'1000001100011001', u'1101001001111011', u'0101100111011010',
               u'1010001100001100', u'1010001111001111', u'0000011100111110', u'0101001001111001',
               u'0100011011011100', u'1011110100000110', u'0111000110011110', u'1010011111110011',
               u'1001010111011010', u'0001101011111010', u'0101000111001010', u'0010110011100101',
               u'0101000011100111', u'1000000111111000', u'0011010111100101', u'1011000011110110',
               u'0010000010101101', u'0111110111010010', u'1010101011101110', u'1101000110011011',
               u'0010110011011000', u'1001000011000001', u'1000111010111001', u'1111011100100101',
               u'1100001111111001', u'1111000011001100', u'0110100001011110', u'1110101000000000',
               u'1100011000001001', u'0110001010110001', u'1100100000000111', u'1100011111100111',
               u'0011000100011111', u'0001000011000101', u'1000010010100111', u'0111111110100001',
               u'1111000000011100', u'0110110011101110', u'0001001110100001', u'1100010000011111',
               u'0110110101001010', u'1001111101011111', u'0111011110110110', u'1111111100011111',
               u'0010001100010001', u'1000000110011001', u'1100100110000111', u'0001011101110011',
               u'1010001000101100', u'0111111101110001', u'1001010100000000', u'1001100111010101',
               u'1110010110101101', u'0011100001010100', u'1100001010001001', u'0111001101000101',
               u'1000000011010011', u'1010001111100101', u'0101010001111001', u'0000011011011000',
               u'1111100101000111', u'0010110011100100', u'0011111100011011', u'1000110110001110',
               u'0110001000100100', u'0001100010100010', u'0101001011000010', u'0010000101011010',
               u'1001000000100111', u'0000011011001000', u'0110010100000010', u'1101111110011001',
               u'1100100110011100', u'1111101100000110', u'0110110011111110', u'1101100010100000',
               u'1010110011111111', u'0111011011001010', u'0111100011011111', u'1011100111111101',
               u'1011100101100111', u'0111100101111000', u'1000001011010111', u'1111000000101010',
               u'1011011111011101', u'0010100101101000', u'1000111110111010', u'0010010100101001',
               u'1100111011111100', u'1000001010010001', u'0100001111000000', u'1000101001001110',
               u'0011001101010101', u'1111000010111001', u'1010000000100111', u'0101000100011001',
               u'0000001101100110', u'1111100101111101', u'1011001101011100', u'1110001100100100',
               u'1101111001001111', u'0000000000100000', u'1010010000011110', u'1010101111111000',
               u'1010111111000000', u'0001001010111001', u'0110110100001001', u'0111110101110001',
               u'1101101001110110', u'1110011010010011', u'0001100111000110', u'0101010101011100',
               u'0110101011001010', u'1000100000100010', u'0000101110110010', u'0101000100100101',
               u'1010011010000111', u'1011001110011110', u'0011001010000001', u'1100101010111111',
               u'1100010000001011', u'0101100010110110', u'1110101101111011', u'0100010011101101',
               u'0001010100000011', u'0011010000000011', u'0001011101010101', u'1100000111110110',
               u'1100011000001001', u'1110001111010110', u'1111001110010101', u'0000110011011000',
               u'0101000011110001', u'1101111100110100', u'0100001100100111', u'1111110101000111',
               u'0000100011001011', u'1000100100111110', u'0100111001000100', u'0000101110111011',
               u'1111111001000000', u'0001101001010000', u'1010000000100000', u'0011111011000001',
               u'1001100101101100', u'0110110111100000', u'1111101110000000', u'0000000111000010',
               u'1001001110101000', u'0111111101101011', u'1100001100111001', u'1001111100110011',
               u'1000001011100001', u'1111111011110111', u'1010110000111110', u'0011110010100100',
               u'0111000000000101', u'1010000000001100', u'1110010001011100', u'1111101000011110',
               u'0111010000011111', u'1101011101010001', u'1000100110000100', u'1001101101101010',
               u'1011101100110110', u'1010000100010101', u'0001101011111111', u'1101011100101011',
               u'1111100111010101', u'0110111110001110', u'1101010111001011', u'0100011001011110',
               u'0110011001010000', u'1011000000001110', u'0010101001011111', u'0101001111011100',
               u'0101111000100111', u'0101000010010100', u'0000111010100111', u'1011001001001101',
               u'0010001000011000', u'0110011010101111', u'0110011011110010', u'0001101000111011',
               u'1001100001101011', u'0001011000000111', u'0111101001101011', u'0001110001111111',
               u'1110110000111011', u'0011101001001011', u'1101001100011101', u'1110110100111011',
               u'0110101100101111', u'0001110001000000', u'1001010000010100', u'1011001001110111',
               u'0000100001110101', u'1110001100001110', u'1011010010011011', u'0001000000101001',
               u'0111010010000001', u'0100011011110010', u'0111101001110101', u'1000111100000110',
               u'1011100010001011', u'1011001101110110', u'1110100111111110', u'0010001100111001',
               u'0010101100010111', u'1100110111111011', u'1010010100111110', u'1000111101100100',
               u'1010011000110001', u'0001001100100000', u'1111111100101000', u'1101000000001100',
               u'0011011100000001', u'1010101011110100', u'1011110001111101', u'0000111101000010',
               u'0001101001011101', u'1100101101010110', u'1101111011010101', u'0100010010001010',
               u'1011001111111110', u'1011100111100010', u'0000101010001000', u'0100000000100000',
               u'0010100100011110', u'0010000010110001', u'0110001110001110', u'0110001000111111',
               u'0000011100000011', u'0011101100110000', u'1001100011010011', u'0101010101010111',
               u'0011111011100101', u'0100111111011011', u'1110110111000100', u'1100111010001011',
               u'0011011110010100', u'1100000111001000', u'0110001111110000', u'1101011110001011',
               u'1001100101111000', u'0100100010011011', u'1110100001011100', u'0010010011011100',
               u'1100011000000010', u'0111010101000001', u'0001000100111110', u'1110111111100011',
               u'1010011011011100', u'1110101001010001', u'0110001010000011', u'0001010101100100',
               u'0110000001101010', u'1101001000000010', u'1110010000001100', u'1010110001010000',
               u'0111001000111110', u'0111100101110111', u'0001100111111000', u'0000110000001100',
               u'1100000110110011', u'0110001000010111', u'1010101000001111', u'0000011110000110',
               u'0101100011100010', u'0010111010001111', u'1010001001001010', u'0011010001101110']
        tmp = []
        while res:
            tmp.append(res.pop())
            if len(tmp) == 64:
                number = "".join(tmp)
                self.random_nums.append(int(number, 2))
                tmp = []

    def is_prime(self, guess, no_of_checks=10):
        """Checks whether the guess is prime
            using Miller Rabin Primality test """
        if guess == 2:
            return True
        if not guess & 1:
            return False

        def check(a, s, d, n):
            x = pow(a, d, n)
            if x == 1:
                return True
            for _ in range(s - 1):
                if x == n - 1:
                    return True
                x = pow(x, 2, n)
            return x == n - 1

        s = 0
        d = guess - 1

        while d % 2 == 0:
            d >>= 1
            s += 1

        for _ in range(no_of_checks):
            a = randrange(2, guess - 1)
            if not check(a, s, d, guess):
                return False
        return True

    def generate_keys(self):
        pass

    def generate_rsa_key_pairs(self):
        self.get_random()
        p = self.random_nums.pop()
        while not self.is_prime(p) and p.bit_length() < 1024:
            p = self.random_nums.pop()
        print "RSA Key Pair, p:", p
        q = self.random_nums.pop()
        while not self.is_prime(q) and q.bit_length() < 1024:
                q = self.random_nums.pop()
        print "RSA Key Pair, q:", q


if __name__ == "__main__":
    gen = RSAKeyGen(url='https://www.random.org/integers')
    gen.generate_rsa_key_pairs()
